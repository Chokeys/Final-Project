<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>클래스 조회</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=DynaPuff&family=Permanent+Marker&display=swap" rel="stylesheet">
    <!--Bootstrap 용 CSS-->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <!--Bootstrap 용 Icon CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <!--font awesome 용-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- datepicker css -->
    <link rel="stylesheet" th:href="@{/css/jquery-ui.min.css}">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <!--header 영역-->
    <header th:replace="~{header :: headerFragment}"></header>

    <!--main 영역-->
    <div id="wrapper">
        <!-- search - List 영역 -->
        <th:block th:if="${#strings.equals(param.search, 'list')}">
           <div th:replace="~{/class/select_list :: selectListFragment}"></div>
        </th:block>
   
       <!-- search - Map 영역 -->
        <th:block th:if="${#strings.equals(param.search, 'map')}">
            <div th:replace="~{/class/select_map :: selectMapFragment}"></div>
        </th:block>
   </div>

<!--jQuery-->
<script th:src="@{/js/jquery-3.6.4.min.js}"></script>
<!--axios library-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.5/axios.min.js"></script>
<!-- datepicker js -->
<script th:src="@{/js/jquery-ui.min.js}"></script>
<!--Bootstrap 용 js -->
<script th:src="@{/js/bootstrap.bundle.min.js"></script>
<script>
    $.datepicker.setDefaults({
        dateFormat: 'yy-mm-dd',
        prevText: '이전 달',
        nextText: '다음 달',
        monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
        showMonthAfterYear: true,
        yearSuffix: '년'
    });

    $(function () {
        $('.datepicker').datepicker({
            onSelect:function(d) {
                var week = new Array('일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일');
                var today = new Date(d).getDay();
                var todaylabel = week[today];
                console.log(todaylabel);
            }
        });
    });

    var citycode = 0;
	var localcode = 0;
	var activitycode = 0;
	var actcode = 0;
	var classlevel = 0;
	var minprice = 0;
	var maxprice = 0;
	var classdate = null;
	var keyword = null;

	searchClassAction();
	
	async function getLocalcate(code) {
		console.log(code);
		
		//const localselect = $('#localselect')[0];
		
		if(code == 1) {
			
			citycode = 0;
			
			$('#localselect').children('option').remove();
			$('#localselect').append('<option>전체</option>');
			
			//localselect.options.length = 0;
			//localselect.innerHTML += '<option>' + '전체' + '</option>';

		}
		
		else {
			
			citycode = code;
			
			const url = '${pageContext.request.contextPath}/api/class/selectcatelist.json?refcode='+code+"&chk=citycate";
			const headers = {"Content-Type":"application/json"};
			//const body = {refcode : code};
			
			const {data} = await axios.get(url, {headers});
			console.log(data);
			
			$('#localselect').children('option').remove();
			//localselect.options.length = 0;
			
			if(data.list.length == 0) {
				$('#localselect').append('<option>전체</option>');
			}
			
			else {
				var options = "";
				for(let obj of data.list) {
					options += "<option value=" + obj.code +  ">" + obj.localcate + "</option>";
				}
				$('#localselect').append(options);
			}
			
		}
		
	}
	
	async function getClasscate(code) {
		console.log(code);
		
		
		if(code == 1) {
			
			activitycode = 0;
			
			$('#actdetailselect').children('option').remove();
			$('#actdetailselect').append('<option value="">전체</option>');
		}
		
		else {
			
			activitycode = code;
			
			const url = '${pageContext.request.contextPath}/api/class/selectcatelist.json?refcode='+code+"&chk=classcate";
			const headers = {"Content-Type":"application/json"};
			//const body = {refcode = code, chk = 'classcate'};
			
			const {data} = await axios.get(url, {headers});
			console.log(data);
			
			$('#actdetailselect').children('option').remove();
			
			if(data.list.length == 0) {
				$('#actdetailselect').append('<option value="">전체</option>');
			}
			else {
				var options = "";
				for(let obj of data.list) {
					options += "<option value=" + obj.code +  ">" + obj.actcate + "</option>";
				}
				$('#actdetailselect').append(options);
			}
			
		}
		
	}
	
	
	function setLocalcate(code) {
		console.log(code);
		
		if(code%100 == 1) {
			localcode = 0;
		}
		else {
			localcode = code;
		}
	}
	
	function setActcate(code) {
		console.log(code);
		
		if(code%100 == 1) {
			actcode = 0;
		}
		else {
			actcode = code;
		}
		
	}
	
	
	$(".levelchk").on("click", function() {
		$(".levelchk").removeClass('active');
		$(this).addClass('active');
	})
	
	$(".levelchk").on("click", function(e) {
		console.log(e.target.value);
		classlevel = e.target.value;
	})
	
	async function searchClassAction() {
		
		if($('#classdate').val().length !== 0) {
			classdate = $("#classdate").val();
		}
		else {
			classdate = null;
		}
		
		if($('#minprice').val().length !== 0) {
			minprice = $("#minprice").val();
		}
		else {
			minprice = 0;
		}
		
		if($('#maxprice').val().length !== 0) {
			maxprice = $("#maxprice").val();
		}
		else {
			maxprice = 0;
		}
		if($('#keyword').val().length !== 0) {
			keyword = $('#keyword').val();
		}
		else {
			keyword = null;
		}
		
		const url = "${pageContext.request.contextPath}/api/class/selectclasslist.json";
		const headers = {"Content-Type":"application/json"};
		
		const {data} = await axios.get(url, 
				{ params: 
				{ 
					citycode : citycode, activitycode : activitycode,
					localcode : localcode, actcode : actcode,
					classlevel : classlevel, classdate : classdate,
					minprice : minprice, maxprice : maxprice, keyword : keyword
				} 
				}, 
				{headers});
		console.log(data);
		
		const classlist = $('#classlist')[0];
		classlist.innerHTML = '';
		for(let obj of data.list) {
			classlist.innerHTML +=
				
				'<div class="col">' +
					'<a href="product.do?classcode='+ obj.classcode + '" class="nav-link">' +
						'<div class="card shadow-sm">' + 
							'<div class="card-header text-center">' + obj.title + '</div>' +
							'<div class="card-body">' +
								'<p class="card-text"> 날짜 : ' + obj.classdate + '</p>' +
								'<p class="card-text"> 가격(1인) : ' + obj.price + '원' + '</p>' +
								'<p class="card-text"> 주소 : ' + obj.address1 + " " + obj.address2 + " " + obj.address3 + '</p>' +
								/* '<div class="d-flex justify-content-between align-items-center">' + 
									'<div>' +
										'<button class="btn btn-sm btn-outline-success">' + '<a href="product.do?classcode=' 
												+ obj.classcode + '" class="nav-link">' + '상세 정보 조회' + '</a>' + '</button>' +
									'<div>' +
								'</div>' + */
							'</div>' +
						'</div>' +
					'</a>' +
				'</div>';
		
		}
		
	};
	
	function resetSearchOption() {
		
		// 1. select box 초기화 -> value 값이 1인 option(전체)을 selected
		
		$("#cityselect").val("1").prop("selected", true);
		$("#activityselect").val("1").prop("selected", true);
		
		// 2. 하위 카테고리의 경우, 초기화 시 모든 option 삭제 -> 디폴트 옵션 추가
		
		$('#localselect').children('option').remove();
		$('#localselect').append('<option>전체</option>');
		
		$('#actdetailselect').children('option').remove();
		$('#actdetailselect').append('<option value="">전체</option>');
		
		// 3. 키워드, 날짜, 최소 가격, 최대 가격 input 태그 값 초기화
		
		$('#keyword').val('');
		$('#classdate').val('');
		$('#minprice').val('');
		$('#maxprice').val('');
		
		// 4. 난이도 선택 초기화 -> active 상태 초기화
		$(".levelchk").removeClass('active');
		
		// 5. 검색 시 입력되는 변수 값 초기화
		citycode = 0;
		localcode = 0;
		activitycode = 0;
		actcode = 0;
		classlevel = 0;
		minprice = 0;
		maxprice = 0;
		classdate = null;
		keyword = null;
		
	};
</script>
</body>
</html>