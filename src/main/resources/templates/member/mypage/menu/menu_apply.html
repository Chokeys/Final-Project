<div th:fragment="menu_apply" class="col-md-8" style="margin-left: 30px">

  <head>
    <link rel="stylesheet" th:href="@{/css/review/review.css}" />
    <link rel="stylesheet" th:href="@{/css/review/detailview.css}" />
    <link rel="stylesheet" th:href="@{/css/quill.snow.css}" />
  </head>
  <!--********************************************************************************************************************************************************************-->
  <!--********************************************************************** 1. 통계 박스 ********************************************************************************-->
  <!--********************************************************************************************************************************************************************-->

  <style>
    /* 처리상태 count box(상단) */
    .box {
      width: 80%;
      height: 150px;
      background: #fff;
      border-radius: 15px;
      margin: 20px;
    }

    .box h3 {
      padding-top: 10px;
      text-align: center;
      font-weight: bold;
      font-size: large;
    }

    .box h1 {
      padding-top: 12px;
      text-align: center;
      font-size: 50px;
    }

    .effect {
      -webkit-box-shadow: 0 5px 6px -6px #777;
      -moz-box-shadow: 0 5px 6px -6px #777;
      box-shadow: 0 5px 6px -6px #777;
    }
  </style>

  <div class="row-md-3">
    <p style="font-weight: bolder; font-size: large">신청내역</p>
    <div class="row" style="background-color: honeydew; border-radius: 15px">
      <div class="col-sm-4">
        <div class="box effect">
          <h3>결제완료</h3>
          <h1 th:text="${chk1}"></h1>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="box effect">
          <h3>결제취소</h3>
          <h1 th:text="${chk2}"></h1>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="box effect">
          <h3>참여완료</h3>
          <h1 th:text="${chk3}"></h1>
        </div>
      </div>
    </div>
  </div>
  <div class="row-md-9" style="margin-top: 50px">
    <hr />
    <div style="display: inline-block; margin-top: 40px; width: 100%">
      <div style="float: left; font-weight: bold">| 신청 클래스 정보</div>
      <div style="float: right">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" id="ulul1"
            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            전체상태
          </button>
          <ul class="dropdown-menu" id="ulul2" role="menu" aria-labelledby="searchType">
            <li><a class="dropdown-item" role="presentation"
                th:href="@{/member/mypage.do(menu=1,page=1,chk=1)}">결제완료</a></li>
            <li><a class="dropdown-item" role="presentation"
                th:href="@{/member/mypage.do(menu=1,page=1,chk=2)}">결제취소</a></li>
            <li><a class="dropdown-item" role="presentation"
                th:href="@{/member/mypage.do(menu=1,page=1,chk=3)}">참여완료</a></li>
          </ul>
        </div>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
            aria-expanded="false">
            신청순
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">최신순</a></li>
            <li><a class="dropdown-item" href="#">오래된순</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!--*****************************************************************************************************************************************************************-->
  <!--********************************************************************** 2. 테이블 ********************************************************************************-->
  <!--*****************************************************************************************************************************************************************-->
  <style>
    .center {
      text-align: center;
    }
  </style>

  <table class="table table-bordered">
    <thead>
      <tr style="background-color: rgb(219, 217, 217); text-align: center">
        <th>결제일자</th>
        <th>이미지</th>
        <th>신청 정보</th>
        <th>결제금액</th>
        <th>처리상태</th>
      </tr>
    </thead>
    <tbody style="vertical-align: middle" id="tbody">
      <tr th:each="obj : ${list}">
        <td class="center">
          <p th:text="${#dates.format(obj.regdate,'yyyy.MM.dd')}"></p>
          <div style="display: flex; flex-direction: column; align-items: center">
            <button class="btn btn-sm btn-outline-success" style="height: 30px; width: 90px"
              th:onclick="modalAction1([[${obj.no}]])">
              상세보기 >
            </button>
          </div>
        </td>
        <td class=" center">
          <img th:src="@{/member/image(classcode=${obj.classcode})}" style="width: 100px; height: 100px" />
        </td>
        <td style="font-size: small">
          <div class="mb-2"><a th:text=" '<'+${obj.title}+'>'" class="a_underline" href="#"></div>
          </a>
          <div id="classdate1" th:text=" '날짜: ' + ${obj.classdate}"></div>
          <div th:text=" '시간: ' + ${obj.classstart} + '~' + ${obj.classend}"></div>
          <div th:text=" '난이도: ' + ${obj.classlevel}"></div>
          <div th:text=" '금액(1인): ' + ${obj.price}+'원'"></div>
          <div th:text=" '신청인원: ' + ${obj.person}+'명'"></div>
        </td>
        <td th:text="${obj.price}+'원'" style="font-weight: bold" class="center">
          25,000원
        </td>
        <td class="center">
          <p style="text-align: center">신청완료</p>
          <button class="btn btn-sm btn-secondary" type="button" style="height: 30px; width: 90px" th:onclick="modalAction([[${obj.no}]],[[${obj.classcode}]],[[${obj.title}]],[[${obj.classdate}]],[[${obj.classstart}]],
            [[${obj.classlevel}]],[[${obj.price}]],[[${obj.person}]])">
            리뷰작성>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="row justify-content-center">
    <div class="col-4">
      <ul id="pagination-demo" class="pagination-sm "></ul>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-4">
      <ul id="pagination-demo1" class="pagination-sm "></ul>
    </div>
  </div>

  <!-- 리뷰 모달 -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #008000; height: 50px">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form th:action="@{/review/insert.do}" id="myform" method="post" enctype="multipart/form-data">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row d-flex flex-nowrap" style="height: 110px">
                <div class="row col-md-6 mx-3" style="border: 1px solid #d3d3d3">
                  <img class="mt-2" name="mainimage" id="mainimage1" th:src="@{/member/image(classcode=156)}" style="
                      width: 110px;
                      height: 90px;
                      position: relative;
                      left: -15px;
                    " />

                  <!-- 클래스 간략한 정보 -->
                  <div class="reviewcontent col-8 mt-2" style="height: 90px; position: relative; left: -15px">
                    <div class="summary d-flex-nowrap">
                      <input id="title" type="text" style="width: 250px;" />
                    </div>
                    <div class="summary">
                      날짜: <input id="classdate" type="text" />
                    </div>
                    <div class="summary">
                      시간: <input id="classstart" type="text" />
                    </div>
                    <div class="summary">
                      난이도: <input id="classlevel" type="text" />
                    </div>
                    <div class="summary">
                      가격: <input id="price" type="text" />
                    </div>
                    <!-- <div class="summary">인원: <input  id="cnt" type="text"></div> -->
                    <input class="summary" id="no" name="no" type="hidden" />
                  </div>
                </div>

                <!-- 별점 레이팅 -->
                <div class="col-md-6">
                  <fieldset>
                    <input type="radio" name="rating" value="5" id="rate1" /><label for="rate1">★</label>
                    <input type="radio" name="rating" value="4" id="rate2" /><label for="rate2">★</label>
                    <input type="radio" name="rating" value="3" id="rate3" /><label for="rate3">★</label>
                    <input type="radio" name="rating" value="2" id="rate4" /><label for="rate4">★</label>
                    <input type="radio" name="rating" value="1" id="rate5" /><label for="rate5">★</label>
                  </fieldset>
                </div>
              </div>

              <!-- 에디터 -->
              <div class="mt-2">
                <div>
                  <div style="margin-top: 10px; background-color: white">
                    <div id="editor" name="content" style="height: 300px"></div>
                  </div>
                </div>

                <input class="form-control" type="file" name="files" id="click_reviewimage1" style="display: none"
                  onchange="readURL1(this)" />
                <input class="form-control" type="file" name="files" id="click_reviewimage2" style="display: none"
                  onchange="readURL2(this)" />
                <input class="form-control" type="file" name="files" id="click_reviewimage3" style="display: none"
                  onchange="readURL3(this)" />
                <input class="form-control" type="file" name="files" id="click_reviewimage4" style="display: none"
                  onchange="readURL4(this)" />

                <!-- 리뷰 이미지(image) -->
                <div class="d-flex justify-content-between mt-2" id="labels">
                  <div>
                    <img for="file1" id="insert_reviewimage1" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview1(this)" />
                  </div>
                  <div>
                    <img for="file1" id="insert_reviewimage2" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview2()" />
                  </div>
                  <div>
                    <img for="file1" id="insert_reviewimage3" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview3()" />
                  </div>
                  <div>
                    <img for="file1" id="insert_reviewimage4" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px; 
                      " src="" onclick="preview4()" />
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <input type="button" class="btn btn-none" value="등록하기" style="
                    background-color: #008000;
                    position: relative;
                    left: -250px;
                    width: 250px;
                    height: 70px;
                    font-size: larger;
                    font-weight: bold;
                    color: white;" onclick="getEditorContent(); reviewNone();" />
              </div>
            </div>
          </div>
          <input type="hidden" name="pages" th:value="${pages}" />
        </form>
        <!-- 스크립트 -->
        <script th:src="@{/js/quill.js}"></script>
        <script th:src="@{/js/review/review.js}"></script>
        <script th:src="@{/js/jquery-3.6.4.min.js}"></script>

        <!-- 신청페이지 조회 -->
        <script th:inline="javascript">
          $(function () {

            async function ajaxBoardList(page) {
              const url = '/specialday/api/member/selectlist.json?page=' + page;
              const headers = { "Content-Type": "application/json" };
              const { data } = await axios.get(url, { headers });

              //2.함수를 pages정보를 넘겨서 생성시킴
              initPagination(data.pages);

              const pagenation1 = document.getElementById('pagination-demo1')
              const tbody = document.getElementById('tbody');

              pagenation1.style.display = 'none';
              tbody.innerHTML = '';

              for (let tmp of data.list) {
                function getyear() {
                  var regdate = tmp.regdate;
                  var result = regdate.substring(0, 10)
                  return result;
                }

                const chk = tmp.chk;
                const level = tmp.classlevel;
                let str = "";
                let str1 = "";

                function chkchk() {
                  if (chk == 1) {
                    str = "&nbsp; 결제완료 &nbsp;";
                  }
                  else if (chk == 2) {
                    str = "&nbsp; 결제취소 &nbsp;";
                  }
                  else if (chk == 3) {
                    str = "&nbsp; 참여완료 &nbsp;";
                  }
                  return str;
                }

                function levelchk() {
                  if (level === 1) {
                    str1 = "입문자";
                  }
                  else if (level === 2) {
                    str1 = "경험자";
                  }
                  else if (level === 3) {
                    str1 = "숙련자";
                  }
                  return str1;
                }
                function reviewChk() {
                  if (chk == 1) {
                    str2 = "d-none";
                  }
                  else if (chk == 2) {
                    str2 = "d-none";
                  }
                  else if (chk == 3) {
                    str2 = "";
                  }
                  return str2;
                }

                tbody.innerHTML +=
                  `<tr>` +
                  `<td class="center">` +
                  `<p>` + getyear() + `</p>` +
                  ` <div
            style="display: flex; flex-direction: column; align-items: center"
          >
            <button class="btn btn-sm btn-outline-success" style="height: 30px; width: 90px"
            onclick="modalAction1(`+ tmp.chk + "," + tmp.person + "," + tmp.totalprice + "," + tmp.no + "," + tmp.classcode + "," + tmp.price + ",\'" + tmp.title + "\'" + ",\'" + tmp.classdate + "\'" + ",\'"
                  + tmp.classlevel + "\'" + ",\'" + tmp.classstart + "\'" + ",\'" + tmp.classend + "\'" + ",\'" + tmp.applyregdate + "\'" + ",\'" + tmp.cancledate + "\'" + `)">
              상세보기
            </button>
          </div>
        </td>
        <td class="center"> 
          <img src="/specialday/member/image?classcode=` + tmp.classcode + `" style="width: 100px; height: 100px"/>
        </td> 
        <td style="font-size: small">
         <div class="mb-2">
          <a class="a_underline" target="_blank" th:href="/class/product.do?classcode=`+ tmp.classcode + `">` + "<" + tmp.title + ">" + `</a>
            </div>

            <div id="classdate1">` + "날짜:" + tmp.classdate + `</div>
            <div >` + "시간:" + tmp.classstart + "~" + tmp.classend + `</div>
            <div >` + "난이도:" + levelchk() + `</div>
            <div >` + "금액(1인):" + tmp.price + "원" + `</div>
            <div >` + "신청인원:" + tmp.person + "명" + `</div>
        </td>
        <td style="font-weight: bold" class="center">` + tmp.payment + "원" + `</td>
        <td class="center">
          <p style="text-align: center;">`+ chkchk() + `</p>
          <button
            class="btn btn-sm btn-secondary ` + reviewChk() + `" 
            id ="button1"
            type="button"
            style="height: 30px; width: 90px"
            onclick="modalAction(`+ tmp.no + "," + tmp.classcode + "," + tmp.price + ",\'" + tmp.title + "\'" + ",\'" + tmp.classdate
                  + "\'" + ",\'" + tmp.classlevel + "\'" + ",\'" + tmp.classstart + "\'" + ",\'" + tmp.classend + "\'" + `)"> 리뷰작성
          </button >
        </td >
                    </tr >`;
              }
            };

            let query = window.location.search;
            let param = new URLSearchParams(query);
            let chk = param.get('chk');
            console.log(param);
            console.log(chk);

            if (chk == null) {
              ajaxBoardList(1)
            }
            //<!-- 페이지네이션 -->     
            function initPagination(pages) {
              // var totalpages = $("input[name=pages]").val();
              // let query = window.location.search;
              // let param = new URLSearchParams(query);
              // let startpage = pages;
              // $('#pagination-demo').twbsPagination('destroy');
              $("#pagination-demo").twbsPagination({
                totalPages: pages,
                visiblePages: 5,
                startPage: 1,
                first: "≪",
                last: "≫",
                prev: "<",
                next: ">",
                initiateStartPageClick: false,
                nextClass: "page-item next",	// 이전 페이지 CSS class
                prevClass: "page-item prev",	// 다음 페이지 CSS class
                lastClass: "page-item last",	// 마지막 페이지 CSS calss
                firstClass: "page-item first",	// 첫 페이지 CSS class
                pageClass: "page-item",	// 페이지 버튼의 CSS class
                activeClass: "active",	// 클릭된 페이지 버튼의 CSS class
                disabledClass: "disabled",	// 클릭 안된 페이지 버튼의 CSS class
                anchorClass: "page-link",	//버튼 안의 앵커에 대한 CSS class
                onPageClick: function (event, page) {
                  ajaxBoardList(page);
                },
              });
            }


            var totalpages = $("input[name=pages]").val();
            let query1 = window.location.search;
            let param1 = new URLSearchParams(query);
            let startpage = param1.get("page");
            let chking = param1.get("chk");

            console.log(totalpages);

            $('#pagination-demo1').twbsPagination({

              totalPages: totalpages,
              visiblePages: 5,
              first: '≪',
              last: '≫',
              prev: '<',
              next: '>',
              initiateStartPageClick: false,
              startPage: startpage,
              nextClass: "page-item next",	// 이전 페이지 CSS class
              prevClass: "page-item prev",	// 다음 페이지 CSS class
              lastClass: "page-item last",	// 마지막 페이지 CSS calss
              firstClass: "page-item first",	// 첫 페이지 CSS class
              pageClass: "page-item",	// 페이지 버튼의 CSS class
              activeClass: "active",	// 클릭된 페이지 버튼의 CSS class
              disabledClass: "disabled",	// 클릭 안된 페이지 버튼의 CSS class
              anchorClass: "page-link",	//버튼 안의 앵커에 대한 CSS class	
              onPageClick: function (event, page, chk) {
                window.location.href = "mypage.do?menu=1&page=" + page + "&chk=" + chking;
              }
            });

            $('#ulul2 li > a').on('click', function () {
              $('#ulul1').text($(this).text());
              httpMethod = $(this).attr('value');
            });
          });

        </script>
      </div>
    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <div class=" col d-inline">
            <img class="logo1" th:src="@{/image/logo.svg}" />
          </div>
          <h1 class="title mt-4" id="exampleModalLabel">주문상세</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="container">
            <div class="row d-flex " style="height: auto;">
              <form th:action="@{/member/updatechk.do}" id="form1" method="POST">
                <input class="date mt-1" id="applyregdate1" disabled />
                <div class="hr1"></div>
                <img class="mainimage1 mt-3 mx-3" name="mainimage" id="mainimage2" />
                <div class="reviewcontent1 col-9 mt-3 "
                  style="height: 90px; position: relative; left: 110px; top: -110px;">
                  <div class="summary1 mx-1" style="width: 300px;">
                    <input id="title1" type="text" disabled style="width: 280px;" />
                  </div>
                  <div class="summary1 mx-2 mt-1">
                    날짜: <input id="classdate2" disabled type="text" />
                  </div>
                  <div class="summary1 mx-2 mt-1">
                    시간: <input id="classstart1" disabled type="text" />
                  </div>
                  <div class="summary1 mx-2 mt-1">
                    난이도: <input id="classlevel1" disabled type="text" />
                  </div>
                  <div class="summary1 mx-2 mt-1">
                    가격: <input id="price1" disabled type="text" />
                  </div>
                </div>
                <div class="hr2 mt-4"></div>
                <div class="detail">결제정보</div>
                <div class="detail-1 mx-2 mt-1">
                  결제날짜 : <input class="detail-3" id="applyregdate2" disabled type="text" />
                </div>
                <div class="detail-1 mx-2 mt-2">
                  클래스금액(1인) : <input class="detail-3" id="price2" disabled type="text" />
                </div>
                <div class="detail-1 mx-2 mt-2">
                  신청인원 : <input class="detail-3" id="person1" disabled type="text" />
                </div>
                <div class="detail-1 mx-2 mt-2">
                  총결제 : <input class="detail-3" id="totalprice1" disabled type="text" />
                </div>
                <div class="detail-1 mx-2 mt-2">
                  처리상태 : <input class="chk detail-3" disabled id="chk1" /></div>
                <div class="hr3 mt-2 mb-2"></div>

                <div id="cancle">
                  <div class="detail mt-4">결제취소정보</div>
                  <div class="detail-1 mx-2 mt-1">
                    취소일자 : <input class="detail-3" id="cancledate" disabled type="text" />
                  </div>
                  <div class="detail-1 mx-2 mt-1">
                    클래스금액(1인) : <input class="detail-3" id="price3" disabled type="text" />
                  </div>
                  <div class="detail-1 mx-2 mt-2">
                    신청인원 : <input class="detail-3" id="person2" disabled type="text" />
                  </div>
                  <div class="detail-1 mx-2 mt-2">
                    환불금액 : <input class="detail-3" id="totalprice3" disabled type="text" style="color: red;" />
                  </div>
                  <div class="hr3"></div>
                </div>

                <button class="chkbtn btn btn-sm btn-danger float-end" type="submit"
                  style="height: 30px; width: 90px;">신청취소</button>

                <input type="hidden" id="no1" name="no">
              </form>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

</div>