<div th:fragment="menu_apply" class="col-md-8" style="margin-left: 30px">

  <head>
    <link rel="stylesheet" th:href="@{/css/review/review.css}" />
    <link rel="stylesheet" th:href="@{/css/quill.snow.css}" />
  </head>
  <!--********************************************************************************************************************************************************************-->
  <!--********************************************************************** 1. 통계 박스 ********************************************************************************-->
  <!--********************************************************************************************************************************************************************-->

  <style>
    /* 처리상태 count box(상단) */
    .box {
      width: 80%;
      height: 150px;
      background: #fff;
      border-radius: 15px;
      margin: 20px;
    }

    .box h3 {
      padding-top: 10px;
      text-align: center;
      font-weight: bold;
      font-size: large;
    }

    .box h1 {
      padding-top: 12px;
      text-align: center;
      font-size: 50px;
    }

    .effect {
      -webkit-box-shadow: 0 5px 6px -6px #777;
      -moz-box-shadow: 0 5px 6px -6px #777;
      box-shadow: 0 5px 6px -6px #777;
    }
  </style>

  <div class="row-md-3">
    <p style="font-weight: bolder; font-size: large">신청내역</p>
    <div class="row" style="background-color: honeydew; border-radius: 15px">
      <div class="col-sm-4">
        <div class="box effect">
          <h3>신청완료</h3>
          <h1>1</h1>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="box effect">
          <h3>참여완료</h3>
          <h1>0</h1>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="box effect">
          <h3>신청취소</h3>
          <h1>0</h1>
        </div>
      </div>
    </div>
  </div>
  <div class="row-md-9" style="margin-top: 50px">
    <hr />
    <div style="display: inline-block; margin-top: 40px; width: 100%">
      <div style="float: left; font-weight: bold">| 신청 클래스 정보</div>
      <div style="float: right">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
            aria-expanded="false">
            전체상태
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">신청완료</a></li>
            <li><a class="dropdown-item" href="#">참여완료</a></li>
            <li><a class="dropdown-item" href="#">신청취소</a></li>
          </ul>
        </div>
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown"
            aria-expanded="false">
            신청순
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">최신순</a></li>
            <li><a class="dropdown-item" href="#">오래된순</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!--*****************************************************************************************************************************************************************-->
  <!--********************************************************************** 2. 테이블 ********************************************************************************-->
  <!--*****************************************************************************************************************************************************************-->
  <style>
    .center {
      text-align: center;
    }
  </style>

  <table class="table table-bordered">
    <thead>
      <tr style="background-color: rgb(219, 217, 217); text-align: center">
        <th>결제일자</th>
        <th>이미지</th>
        <th>신청 정보</th>
        <th>결제금액</th>
        <th>처리상태</th>
      </tr>
    </thead>
    <tbody style="vertical-align: middle" id="tbody">
      <!-- <tr th:each="obj : ${list}">
        <td class="center">
          <p th:text="${#dates.format(obj.applyregdate,'yyyy.MM.dd')}"></p>
          <div
            style="display: flex; flex-direction: column; align-items: center"
          >
            <button
              class="btn btn-sm btn-outline-success"
              style="height: 30px; width: 90px"
            >
              상세보기 >
            </button>
            <button class="btn btn-sm btn-danger"
                            style="height: 30px; width: 90px; margin-top: 5px;">신청취소</button>
          </div>
        </td>
        <td class="center">
          <img
            th:src="@{/member/image.do(classcode=${obj.classcode})}"
            style="width: 100px; height: 100px"
          />
        </td>
        <td style="font-size: small">
         <div class="mb-2"><a th:text=" '<'+${obj.title}+'>'" class="a_underline" href="#"></div>
          </a>
          <div id="classdate1" th:text=" '날짜: ' + ${obj.classdate}"></div>
          <div
            th:text=" '시간: ' + ${obj.classstart} + '~' + ${obj.classend}"
          ></div>
          <div th:text=" '난이도: ' + ${obj.classlevel}"></div>
          <div th:text=" '금액(1인): ' + ${obj.price}+'원'"></div>
          <div th:text=" '신청인원: ' + ${obj.person}+'명'"></div>
        </td>
        <td
          th:text="${obj.price}+'원'"
          style="font-weight: bold"
          class="center"
        >
          25,000원
        </td>
        <td class="center">
          <p style="text-align: center">신청완료</p>
          <button
            class="btn btn-sm btn-secondary"
            type="button"
            style="height: 30px; width: 90px"
            onclick="modalAction('2','도자기 슥','6월1일','15:00','입문자','10000원','2명')"
          >
            리뷰작성>
          </button>
        </td>
      </tr> -->

      <!-- 처리상태별 예시 -->
      <!-- <tr>
                <td class="center">
                    <p>2023-05-22</p>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <button class="btn btn-sm btn-outline-success" style="height: 30px; width: 90px;">상세보기
                            ></button>
                        <button class="btn btn-sm btn-danger"
                            style="height: 30px; width: 90px; margin-top: 5px;">신청취소</button>
                    </div>
                </td>
                <td class="center">
                    <img src="https://cdnimage.ebn.co.kr/news/202003/news_1583367095_1024915_main1.jpg"
                        style="width: 100px; height: 100px;">

                </td>
                <td style="font-size: small;">
                    <a href="#">
                        <p style="margin-top: 10px;">서핑 여름 특강</p>
                    </a> 
                    <div>일자 : 2023-06-01</div>
                    <div>시간 : 15:00 ~ 21:00</div>
                    <div>난이도 : 입문자</div>
                    <div >1인기준 금액 : 25000</div>
                    <div >신청인원 : 1명</div>
                </td>
                <td style="font-weight: bold;" class="center">55,000원</td>
                <td class="center">
                    <p style="text-align: center;">참여완료</p>
                    <button class="btn btn-sm btn-secondary" type="button" style="height: 30px; width: 90px;"
                     onclick="modalAction('2','도자기 슥','6월1일','15:00','입문자','10000원','2명')">리뷰작성></button>
                </td>
            </tr>
            <tr>
                <td class="center">
                    <p>2023-05-20</p>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <button class="btn btn-sm btn-outline-success" style="height: 30px; width: 90px;">상세보기
                            ></button>
                        <button class="btn btn-sm btn-danger disabled"
                            style="height: 30px; width: 90px; margin-top: 5px;">신청취소</button>
                    </div>
                </td>
                <td class="center">
                    <img src="https://cdnimage.ebn.co.kr/news/202003/news_1583367095_1024915_main1.jpg"
                        style="width: 100px; height: 100px;">
                </td>
                <td style="font-size: small;">
                    <a href="#">
                        <p style="margin-top: 10px;">유화 원데이클래스</p>
                    </a>
                    <div>일자 : 2023-06-01</div>
                    <div>시간 : 15:00 ~ 21:00</div>
                    <div>난이도 : 입문자</div>
                    <div>1인기준 금액 : 25000</div>
                    <div>신청인원 : 1명</div>
                </td>
                <td style="font-weight: bold;" class="center">155,000원</td>
                <td class="center">
                    <p style="text-align: center;">신청취소</p>
                    <button class="btn btn-sm btn-secondary disabled" style="height: 30px; width: 90px;">리뷰작성 ></button>
                </td>
            </tr> -->

      <!-- 클래스 신청내역이 없을 경우-->
      <!-- <h7>클래스 신청내역이 존재하지 않습니다.</h7>
                <button>클래스 조회 화면으로 가는 버튼</button> -->
    </tbody>
  </table>
  <div class="row justify-content-center">
    <div class="col-4">
      <ul id="pagination-demo" class="pagination-sm "></ul>
    </div>
  </div>

  <!-- 리뷰 모달 -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: #008000; height: 50px">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form th:action="@{/review/insert.do}" id="myform" method="post" enctype="multipart/form-data">
          <div class="modal-body">
            <div class="container-fluid">
              <div class="row d-flex flex-nowrap" style="height: 110px">
                <div class="row col-md-6 mx-3" style="border: 1px solid #d3d3d3">
                  <img class="mt-2" name="mainimage" id="mainimage1" th:src="@{/member/image.do(classcode=0)}" style="
                      width: 110px;
                      height: 90px;
                      position: relative;
                      left: -15px;
                    " />

                  <!-- 클래스 간략한 정보 -->
                  <div class="reviewcontent col-8 mt-2" style="height: 90px; position: relative; left: -15px">
                    <div class="summary d-flex-nowrap">
                      <input id="title" type="text" style="width: 250px;" />
                    </div>
                    <div class="summary">
                      날짜: <input id="classdate" type="text" />
                    </div>
                    <div class="summary">
                      시간: <input id="classstart" type="text" />
                    </div>
                    <div class="summary">
                      난이도: <input id="classlevel" type="text" />
                    </div>
                    <div class="summary">
                      가격: <input id="price" type="text" />
                    </div>
                    <!-- <div class="summary">인원: <input  id="cnt" type="text"></div> -->
                    <input class="summary" id="no" name="apply.no" type="hidden" />
                  </div>
                </div>

                <!-- 별점 레이팅 -->
                <div class="col-md-6">
                  <fieldset>
                    <input type="radio" name="rating" value="5" id="rate1" /><label for="rate1">★</label>
                    <input type="radio" name="rating" value="4" id="rate2" /><label for="rate2">★</label>
                    <input type="radio" name="rating" value="3" id="rate3" /><label for="rate3">★</label>
                    <input type="radio" name="rating" value="2" id="rate4" /><label for="rate4">★</label>
                    <input type="radio" name="rating" value="1" id="rate5" /><label for="rate5">★</label>
                  </fieldset>
                </div>
              </div>

              <!-- 에디터 -->
              <div class="mt-2">
                <div>
                  <div style="margin-top: 10px; background-color: white">
                    <div id="editor" name="content" style="height: 300px"></div>
                  </div>
                </div>

                <input class="form-control" type="file" name="files" id="click_reviewimage1" style="display: none"
                  onchange="readURL1(this)" />
                <input class="form-control" type="file" name="files" id="click_reviewimage2" style="display: none"
                  onchange="readURL2(this)" />
                <input class="form-control" type="file" name="files" id="click_reviewimage3" style="display: none"
                  onchange="readURL3(this)" />
                <input class="form-control" type="file" name="files" id="click_reviewimage4" style="display: none"
                  onchange="readURL4(this)" />

                <!-- 리뷰 이미지(image) -->
                <div class="d-flex justify-content-between mt-2" id="labels">
                  <div>
                    <img for="file1" id="insert_reviewimage1" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview1(this)" />
                  </div>
                  <div>
                    <img for="file1" id="insert_reviewimage2" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview2()" />
                  </div>
                  <div>
                    <img for="file1" id="insert_reviewimage3" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview3()" />
                  </div>
                  <div>
                    <img for="file1" id="insert_reviewimage4" class="d-sm-inline-flex mx-2 mt-2" style="
                        border: 1px dashed gray;
                        width: 160px;
                        height: 150px;
                      " src="" onclick="preview4()" />
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <input type="button" class="btn btn-none" value="등록하기" style="
                    background-color: #008000;
                    position: relative;
                    left: -250px;
                    width: 250px;
                    height: 70px;
                    font-size: larger;
                    font-weight: bold;
                    color: white;
                  " onclick="getEditorContent()" />
              </div>
            </div>
          </div>
          <input type="hidden" name="pages" th:value="${pages}" />
        </form>
        <!-- 스크립트 -->
        <script th:src="@{/js/quill.js}"></script>
        <script th:src="@{/js/review/review.js}"></script>
        <script th:src="@{/js/jquery-3.6.4.min.js}"></script>
        <script th:src="@{/js/bootstrap.bundle.min.js}"></script>

        <!-- 신청페이지 조회 -->
        <script th:inline="javascript">
          $(function () {
            async function ajaxBoardList(page) {
              const url = '/specialday/api/member/selectlist.json?page=' + page;
              const headers = { "Content-Type": "application/json" };
              const { data } = await axios.get(url, { headers });

              //2.함수를 pages정보를 넘겨서 생성시킴
              initPagination(data.pages);

              const tbody = document.getElementById('tbody');
              tbody.innerHTML = '';

              for (let tmp of data.list) {
                function getyear() {
                  var applyregdate = tmp.applyregdate;
                  var result = applyregdate.substring(0, 10)
                  return result;
                }

                const chk = tmp.chk;
                const level = tmp.classlevel;
                let str = "";
                let str1 = "";

                function chkchk() {
                  if (chk == 1) {
                    str = "신청완료!!";
                    // addclassname()
                  }
                  else if (chk == 2) {
                    str = "신청취소";
                  }
                  else if (chk == 2) {
                    str = "참여완료";
                  }
                  return str;
                }

                function levelchk() {
                  if (level == 1) {
                    str1 = "입문자";

                  }
                  else if (level == 2) {
                    str1 = "중수";
                  }
                  else if (level == 3) {
                    str1 = "고수";
                  }
                  return str1;
                }



                tbody.innerHTML +=
                  `<tr>` +
                  `<td class="center">` +
                  `<p>` + getyear() + `</p>` +
                  ` <div
            style="display: flex; flex-direction: column; align-items: center"
          >
            <button
              class="btn btn-sm btn-outline-success"
              style="height: 30px; width: 90px"
            >
              상세보기 >
            </button>
          </div>
        </td>
        <td class="center"> 
          <img src="http://192.168.219.103:8080/specialday/member/image.do?classcode=` + tmp.classcode + `" style="width: 100px; height: 100px"/>
        </td> 
        <td style="font-size: small">
         <div class="mb-2">
          <a class="a_underline" href="#">` + "<" + tmp.title + ">" + `</a>
            </div>

            <div id="classdate1">` + "날짜:" + tmp.classdate + `</div>
            <div >` + "시간:" + tmp.classstart + "~" + tmp.classend + `</div>
            <div >` + "난이도:" + levelchk() + `</div>
            <div >` + "금액(1인):" + tmp.price + "원" + `</div>
            <div >` + "신청인원:" + tmp.person + "명" + `</div>
        </td>
        <td style="font-weight: bold" class="center">` + tmp.totalprice + "원" + `</td>
        <td class="center">
          <p style="text-align: center">`+ chkchk() + `</p>
          <button
            class="btn btn-sm btn-secondary" 
            id ="button"
            type="button"
            style="height: 30px; width: 90px"
            onclick="modalAction(`+ tmp.no + "," + tmp.classcode + "," + tmp.price + ",\'" + tmp.title + "\'" + ",\'" + tmp.classdate
                  + "\'" + ",\'" + tmp.classlevel + "\'" + ",\'" + tmp.classstart + "\'" + ",\'" + tmp.classend + "\'" + `)"> 리뷰작성
          </button >
        </td >
                    </tr >`;
              }
            };
            ajaxBoardList(1)

            //<!-- 페이지네이션 -->     
            function initPagination(pages) {
              $('#pagination-demo').twbsPagination('destroy');
              var totalpages = $("input[name=pages]").val();
              let query = window.location.search;
              let param = new URLSearchParams(query);
              let startpage = param.get("page");
              $("#pagination-demo").twbsPagination({
                totalPages: totalpages,
                visiblePages: 5,
                startPage: startpage,
                first: "≪",
                last: "≫",
                prev: "<",
                next: ">",

                initiateStartPageClick: false,
                nextClass: "page-item next",	// 이전 페이지 CSS class
                prevClass: "page-item prev",	// 다음 페이지 CSS class
                lastClass: "page-item last",	// 마지막 페이지 CSS calss
                firstClass: "page-item first",	// 첫 페이지 CSS class
                pageClass: "page-item",	// 페이지 버튼의 CSS class
                activeClass: "active",	// 클릭된 페이지 버튼의 CSS class
                disabledClass: "disabled",	// 클릭 안된 페이지 버튼의 CSS class
                anchorClass: "page-link",	//버튼 안의 앵커에 대한 CSS class
                onPageClick: function (event, page) {
                  ajaxBoardList(page);
                },
              });
            }
          }); 
        </script>
      </div>
    </div>
  </div>
</div>