<div th:fragment="menu_unitmanage">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.0/main.min.js"></script>
    <!-- full calendar -->
    <script th:src=@{/js/classunit/index.global.js}></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.css">
    <!-- fullcalendar 언어 설정관련 script -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/locales-all.js"></script>
    <!-- jquery -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- bootstrap4 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- css -->
    <link rel="stylesheet" th:href="@{/css/jquery-ui.min.css}">
    <link rel="stylesheet" th:href="@{/css/classunit/menu_unitmanage.css}">

    <style>
        body {
          padding: 0;
          font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
          font-size: 14px;
        }
      
        #calendar {
          max-width: 1100px;
          margin: 0 auto;
        }

        /* 오른쪽 사이드바 */
        .show-right-side-bar-btn {
            float: right;
        }

        #right-side-bar {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100%;
            background-color: rgb(204, 228, 119);
            transition: right 0.5s, background-color 0.5s;
            z-index: 9999;
        }

        #right-side-bar.active {
            right: 0;
            background-color: rgb(237, 243, 235);
        }

        #right-side-bar-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: none;
        }

        #closeButton {
            cursor: pointer;
        }

    </style>
    
    <div id='calendar'></div>
    <div style="margin-top: 5px; font-size: small; font-weight: normal; color: gray;">*개설강의에 대한 상세일정을 등록해주세요.</div>
    
    <div id="right-side-bar">
        <div style="margin: 20px;">
            <div class="sidevar-header" style="display: inline-block; width: 100%;">
                <div id="closeButton"><i class="fa-solid fa-x" style="float: left; margin-top: 5px;"></i></div>
                <div style="font-weight: bold; font-size: large; margin-left: 10px; float: left;">전체 일정</div>
                <div style="float: right;"><input type="button" value="일정 전체 삭제" class="btn btn-sm btn-secondary" id="all_delete"></div><br/>
            </div>
            <hr />
            <div class="sidevar-body">
                <div class="unit-list" style="margin-top: 5px;"></div>
            </div>
        </div>        
    </div>
    <div id="right-side-bar-bg"></div>



    <!-- 일정 등록 modal -->
    <div class="modal fade" id="unitInsertModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">클래스 일정을 입력하세요.</h5>
                    <button type="button" class="close" onclick="cancel()" style="border: none; background-color: white; font-size: xx-large;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="form-group" style="display: inline-block;">
                        <input type="number" class="form-control" id="classcode" th:value="${classcode}" name="classcode">
                        <div class="row">
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="minimum" class="col-form-label">최소인원</label>
                                <input type="number" class="form-control" id="minimum" name="minimum">
                            </div>
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="maximum" class="col-form-label">최대인원</label>
                                <input type="number" class="form-control" id="maximum" name="maximum">
                            </div>   
                        </div>

                        <div class="row">
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="classdate" class="col-form-label">날짜</label>
                                <input class="form-control datepicker date" id="classdate" name="classdate">
                            </div>

                            <input type="hidden" name="classday" id="classday">

                            <!-- <div class="col-sm-3" style="width: 50%;">
                                <label for="calendar_end_date" class="col-form-label">종료 날짜</label>
                                <input class="form-control datepicker date" id="calendar_end_date" name="calendar_end_date">
                            </div>    -->
                        </div>

                        <div class="row">
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="classstart" class="col-form-label">시작 시각</label>
                                <input type="time" class="form-control" id="classstart" name="classstart">
                            </div>
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="classend" class="col-form-label">종료 시각</label>
                                <input type="time" class="form-control" id="classend" name="classend">
                            </div>   
                        </div>

                        
                        <div class="col">
                            <label style="font-size: small; margin-top: 20px;">* 클래스 난이도와 수강금액에 변동이있을 시 작성해주세요.</label><br />
                            <div class="form-check form-check-inline" style="margin-top: 10px;">
                                <input type="radio" class="form-check-input radio-value level-value-detail" id="classlevel1" name="classlevel"  value="1" checked>
                                <label class="form-check-label" for="classlevel1">입문자</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input type="radio" class="form-check-input radio-value level-value-detail" id="classlevel2" name="classlevel"  value="2">
                                <label class="form-check-label" for="classlevel2">경험자</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input type="radio" class="form-check-input radio-value level-value-detail" id="classlevel3" name="classlevel"  value="3">
                                <label class="form-check-label" for="classlevel3">숙련자</label>
                            </div>                    
                        </div>

                        <div class="row">
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="defaultPrice" class="col-form-label">입문자 수강금액</label>
                                <input type="number" class="form-control" id="defaultPrice" name="defaultPrice" th:value="${defaultPrice}" disabled readonly>
                            </div>
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="addprice" class="col-form-label">추가 금액</label>
                                <input type="number" class="form-control" id="addprice" name="addprice" value="" disabled>
                            </div>   
                        </div>

                        <div class="row">
                            <div class="col-sm-3" style="width: 50%;">
                                <input type="checkbox" class="form-check-input" id="discount-chk" name="discount-chk" onchange="toggleDiscountInput()" style="margin-top: 10px;">
                                <label for="discount" class="col-form-label" style="margin-left: 5px;">할인 비율 설정(%)</label>
                                <input type="number" class="form-control" id="discount" name="discount" value="" disabled>
                            </div>
                            <div class="col-sm-3" style="width: 50%;">
                                <label for="discount_price" class="col-form-label">할인된 금액</label>
                            <input type="number" class="form-control" id="discount_price" name="discount_price" value="" readonly>
                            </div>   
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="d-flex justify-content-between" style="width: 100%;">
                        <div style="width: 49%;">
                            <button type="button" style="border: 1px solid gray; width: 100%;" class="btn btn-sm" data-dismiss="modal" onclick="cancel()">닫기</button>
                        </div>
                        <div style="width: 49%;">
                            <input type="button" value="추가" style="border: 1px solid gray; width: 100%;" class="btn btn-sm" onclick="add()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

     <!-- 일정 수정 modal 아직 완료x -->
     <div class="modal fade" id="unitUpdateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
     <div class="modal-dialog" role="document">
         <div class="modal-content">
             <div class="modal-header">
                 <h5 class="modal-title" id="exampleModalLabel">클래스 일정을 입력하세요.</h5>
                 <button type="button" class="close" onclick="cancel()" style="border: none; background-color: white; font-size: xx-large;">
                     <span aria-hidden="true">&times;</span>
                 </button>
             </div>
             
             <div class="modal-body">
                 <input type="number" id="classcode2" th:value="${classcode}">
                 <div class="form-group" style="display: inline-block;">
                     <div class="row">
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="minimum2" class="col-form-label">최소인원</label>
                             <input type="number" class="form-control" id="minimum2" name="minimum2">
                         </div>
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="maximum2" class="col-form-label">최대인원</label>
                             <input type="number" class="form-control" id="maximum2" name="maximum2">
                         </div>   
                     </div>

                     <div class="row">
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="classdate2" class="col-form-label">날짜</label>
                             <input class="form-control datepicker date" id="classdate2" name="classdate2">
                         </div>

                         <input type="hidden" name="classda2y" id="classday2">

                         <!-- <div class="col-sm-3" style="width: 50%;">
                             <label for="calendar_end_date" class="col-form-label">종료 날짜</label>
                             <input class="form-control datepicker date" id="calendar_end_date" name="calendar_end_date">
                         </div>    -->
                     </div>

                     <div class="row">
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="classstart2" class="col-form-label">시작 시각</label>
                             <input type="time" class="form-control" id="classstart2" name="classstart2">
                         </div>
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="classend2" class="col-form-label">종료 시각</label>
                             <input type="time" class="form-control" id="classend2" name="classend2">
                         </div>   
                     </div>

                     
                     <div class="col">
                         <label style="font-size: small; margin-top: 20px;">* 클래스 난이도와 수강금액에 변동이있을 시 작성해주세요.</label><br />
                         <div class="form-check form-check-inline" style="margin-top: 10px;">
                             <input type="radio" class="form-check-input radio-value level-value-detail" id="classlevel1" name="classlevel"  value="1" checked>
                             <label class="form-check-label" for="classlevel1">입문자</label>
                         </div>
                         <div class="form-check form-check-inline">
                             <input type="radio" class="form-check-input radio-value level-value-detail" id="classlevel2" name="classlevel"  value="2">
                             <label class="form-check-label" for="classlevel2">경험자</label>
                         </div>
                         <div class="form-check form-check-inline">
                             <input type="radio" class="form-check-input radio-value level-value-detail" id="classlevel3" name="classlevel"  value="3">
                             <label class="form-check-label" for="classlevel3">숙련자</label>
                         </div>                    
                     </div>

                     <div class="row">
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="defaultPrice2" class="col-form-label">입문자 수강금액</label>
                             <input type="number" class="form-control" id="defaultPrice2" name="defaultPrice2" th:value="${defaultPrice}" disabled readonly>
                         </div>
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="addprice2" class="col-form-label">추가 금액</label>
                             <input type="number" class="form-control" id="addprice2" name="addprice2" value="" disabled>
                         </div>   
                     </div>

                     <div class="row">
                         <div class="col-sm-3" style="width: 50%;">
                             <input type="checkbox" class="form-check-input" id="discount-chk2" name="discount-chk" onchange="toggleDiscountInput()" style="margin-top: 10px;">
                             <label for="discount2" class="col-form-label" style="margin-left: 5px;">할인 비율 설정(%)</label>
                             <input type="number" class="form-control" id="discount2" name="discount2" value="" disabled>
                         </div>
                         <div class="col-sm-3" style="width: 50%;">
                             <label for="discount_price2" class="col-form-label">할인된 금액</label>
                         <input type="number" class="form-control" id="discount_price2" name="discount_price2" value="" readonly>
                         </div>   
                     </div>
                 </div>
             </div>
             <div class="modal-footer">
                 <div class="d-flex justify-content-between" style="width: 100%;">
                     <div style="width: 49%;">
                         <button type="button" style="border: 1px solid gray; width: 100%;" class="btn btn-sm" data-dismiss="modal" onclick="cancel2()">닫기</button>
                     </div>
                     <div style="width: 49%;">
                         <input type="button" value="완료" style="border: 1px solid gray; width: 100%;" class="btn btn-sm" onclick="add()">
                     </div>
                 </div>
             </div>
         </div>
     </div>
 </div>

    
    <script th:src="@{/js/jquery-3.6.4.min.js}"></script>
    <script th:src="@{/js/jquery-ui.min.js}"></script>
    <script th:src="@{/js/classunit/menu_unitmanage.js}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.5/axios.min.js"></script>
    <!-- <script th:src="@{/js/axios.min.js}"></script> -->
    <script type="text/javascript" th:inline="javascript">
        
        // 달력
        document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView : 'dayGridMonth', // 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
            headerToolbar : { // 헤더에 표시할 툴 바
                start : 'prev next today',
                center : 'title',
                 end : 'addEventButton selectEventButton'
            },
            customButtons: {
                    addEventButton: { 
                        text : "일정 추가",  
                        click : function(){ 
                            $("#unitInsertModal").modal("show"); 

                            $("#addCalendar").on("click",function(){  // modal의 추가 버튼 클릭 시
                                var content = $("#calendar_content").val();
                                var start_date = $("#calendar_start_date").val();
                                var end_date = $("#calendar_end_date").val();
                                
                                //내용 입력 여부 확인
                                // if(content == null || content == ""){
                                //     alert("내용을 입력하세요.");
                                // }else if(start_date == "" || end_date ==""){
                                //     alert("날짜를 입력하세요.");
                                // }else if(new Date(end_date)- new Date(start_date) < 0){ // date 타입으로 변경 후 확인
                                //     alert("종료일이 시작일보다 먼저입니다.");
                                // }else{ // 정상적인 입력 시
                                //     var obj = {
                                //         "title" : content,
                                //         "start" : start_date,
                                //         "end" : end_date
                                //     }//전송할 객체 생성

                                //     console.log(obj); //서버로 해당 객체를 전달해서 DB 연동 가능
                                // }
                            });
                        }
                    },
                    selectEventButton: { // 추가한 버튼 설정
                        text : "전체 일정",  // 버튼 내용
                        click : function(){ // 버튼 클릭 시 이벤트 추가
                            selectAll();
                            showRightSideBar(); // 오른쪽 사이드바를 보여주는 함수 호출
                           
                        }
                    }
            },
            titleFormat : function(date) {
                return date.date.year + '년 ' + (parseInt(date.date.month) + 1) + '월';
            },
            //initialDate: '2021-07-15', // 초기 날짜 설정 (설정하지 않으면 오늘 날짜가 보임)
            selectable : true, // 달력 일자 드래그 설정가능
            droppable : true,
            editable : false,  // false로 변경 시 draggable 작동 x ,
            displayEventTime: false, // 시간 표시 x
            nowIndicator: true, // 현재 시간 마크
            locale: 'ko', // 한국어 설정
            events:[ // 일정 데이터 추가 , DB의 event를 가져오려면 JSON 형식으로 변환해 events에 넣어줘야함.
                    {
                        title:'일정',
                        start:'2023-06-01 00:00:00',
                        end:'2023-06-03 24:00:00'
                    }
                ]
            });
            calendar.render();
        });
        
        // 일정등록 모달창 닫기 
        function cancel() {
            $("#unitInsertModal").modal("hide"); 
        }
        
        console.log(document.getElementById("classcode").value);
        // 일정등록 
        async function add(){
            const classcode = document.getElementById("classcode").value;
            console.log(classcode);
            const min = document.getElementById("minimum").value;
            const max = document.getElementById("maximum").value;
            const date = document.getElementById("classdate").value;
            const day = document.getElementById("classday").value;
            const start = document.getElementById("classstart").value;
            const end = document.getElementById("classend").value;
            var level = document.querySelector('input[name="classlevel"]:checked').value;
            const discount = document.getElementById("discount").value;
            const addprice = document.getElementById("addprice").value;            
            
            // POST호출
            const url = /*[[@{/api/classunit/insert.json}]]*/"";
            const headers = {"Content-Type":"application/json"};
            const body = {  classproduct:{classcode:classcode}, 
                            minimum : min, 
                            maximum : max, 
                            classdate : date, 
                            classday : day, 
                            classstart : start, 
                            classend : end, 
                            classlevel : level, 
                            discount : discount, 
                            addprice : addprice };
            
            // console.log(body);
            const { data } = await axios.post(url, body, { headers:headers });
            console.log('반환되는 결과', data);

            if(data.status === 200){
                alert("일정 등록이 완료되었습니다.")
                $('#unitInsertModal').modal('hide'); // 모달 창 닫기
                // resetModalInputs(); // 입력 필드 초기화
            }
            else {
                alert("일정 등록에 실패하였습니다.");
            }
        }

        //모달 창 열릴 때 초기화 함수 호출
        $('#unitInsertModal').on('shown.bs.modal', function() {
            resetModalInputs();
        });

        function resetModalInputs() {
            // document.getElementById("classcode").value = "";
            document.getElementById("minimum").value = "";
            document.getElementById("maximum").value = "";
            document.getElementById("classdate").value = "";
            document.getElementById("classday").value = "";
            document.getElementById("classstart").value = "";
            document.getElementById("classend").value = "";
            document.getElementById("discount").value = "";
            document.getElementById("addprice").value = "";
            document.getElementById("discount_price").value = "";
            document.getElementById("classlevel1").checked = true;
            document.getElementById("addprice").disabled = true;
        }
        
        // 할인 금액 계산
        function calculateDiscount() {
            var defaultPrice = parseInt(document.getElementById("defaultPrice").value);
            var discount = parseInt(document.getElementById("discount").value);
            var addprice = parseInt(document.getElementById("addprice").value);
            console.log(defaultPrice);
            console.log(discount);
            console.log(addprice);

            var discountAmount = (defaultPrice + addprice) * discount / 100;
            var discountPrice = (defaultPrice + addprice) - discountAmount;

            // 할인된 금액을 discount_price input 요소에 업데이트
            document.getElementById("discount_price").value = discountPrice;
        }
        document.getElementById("discount").addEventListener("change", calculateDiscount);

        // 할일 비율 설정시 체크 후 입력란 활성화
        function toggleDiscountInput() {
            var discountCheckbox = document.getElementById("discount-chk");
            var discountInput = document.getElementById("discount");
            var discountPriceInput = document.getElementById("discount_price");

            if (discountCheckbox.checked) {
                discountInput.disabled = false;
                discountInput.value = "";
                discountPriceInput.value = "";
            } else {
                discountInput.disabled = true;
                discountInput.value = "";
                discountPriceInput.value = "";
            }
        }

        // 클래스 난이도별 추가 금액 입력란 활성화
        var radioBtns = document.querySelectorAll('.radio-value');
        function handleRadioClick() {
            var addpriceInput = document.getElementById('addprice');
            var level = document.querySelector('input[name="classlevel"]:checked').value;
            addpriceInput.disabled = !(level === '2' || level === '3');
        }

        radioBtns.forEach(function(radioBtn) {
            radioBtn.addEventListener('click', handleRadioClick);
        });

        // *********************************************************************** 오른쪽 슬라이드 **********************************************************************************

        // 오른쪽 사이드바 열기
        function showRightSideBar() {
            var rightSideBar = document.getElementById('right-side-bar');
            var rightSideBarBg = document.getElementById('right-side-bar-bg');
            rightSideBar.classList.add('active');
            rightSideBarBg.style.display = 'block';
        }

        // 오른쪽 사이드바 닫기
        function hideRightSideBar() {
            var rightSideBar = document.getElementById('right-side-bar');
            var rightSideBarBg = document.getElementById('right-side-bar-bg');
            rightSideBar.classList.remove('active');
            rightSideBarBg.style.display = 'none';
        }

        // 닫기 버튼 클릭 이벤트 처리
        document.getElementById('closeButton').addEventListener('click', hideRightSideBar);

        // 오른쪽 사이드바 배경 클릭 시 닫기
        document.getElementById('right-side-bar-bg').addEventListener('click', hideRightSideBar);


        /******************************** 일정 하나 수정, 삭제 ***************************************/
        function cancel2() {
            $('#unitUpdateModal').modal('hide');
        }

        async function updateUnit(classcode, no){
            let url = /*[[@{/api/classunit/selectunitone.json}]]*/"";
            url += `?classcode=${classcode}&no=${no}`;
            const body = {  classproduct:{classcode:classcode}, no : no };
            const headers = {"Content-Type":"application/json"};
            const { data } = await axios.put(url, body, { headers:headers });
            console.log(url);
            console.log("classcode:", classcode, "no:", no);

            document.getElementById('classcode2').value = classcode;
            document.getElementById('minimum2').value = data.obj.minimum;
            document.getElementById('maximum2').value = data.obj.maximum;
            document.getElementById('classdate2').value = data.obj.classdate;
            document.getElementById('classday2').value = data.obj.classday;
            document.getElementById('classstart2').value = data.obj.classstart;
            document.getElementById('classend2').value = data.obj.classend;
            document.getElementById('defaultPrice2').value = data.obj.defaultPrice;
            document.getElementById('addprice2').value = data.obj.addprice;
            document.getElementById('discount2').value = data.obj.discount;
            document.getElementById('discount_price2').value = data.obj.discount_price;

            $('#unitUpdateModal').modal('show');
        };

        async function deleteUnit(classcode, no){
            let url = /*[[@{/api/classunit/deleteone.json}]]*/"";
            url += `?classcode=${classcode}&no=${no}`;
            const body = {  classproduct:{classcode:classcode}, 
                            no : no };
            const headers = {"Content-Type":"application/json"};
            const { data } = await axios.put(url, body, { headers:headers });
            console.log("classcode:", classcode, "no:", no);

            if(data.status === 200){
                alert("삭제가 완료되었습니다.");
                const deletedUnit = document.getElementById(`unit-${no}`);
                if (deletedUnit) {
                    const parentDiv = deletedUnit.parentElement;
                    if (parentDiv) {
                        parentDiv.style.border = "none";
                        parentDiv.style.backgroundColor = "transparent";
                        parentDiv.style.height = "0";
                        parentDiv.style.padding = "0";
                        parentDiv.style.marginTop = "0";
                        
                    }
                    deletedUnit.remove();
                }
            }
            else {
                alert("삭제에 실패하였습니다.");
            }
        };
        /*************************************************************************************/
        const ccode = /*[[${classcode}]]*/""; // ClassUnitController에서 받은 classcode

        //일정 조회
        async function selectAll(){
            const classcode = document.getElementById("classcode").value;
            // console.log(classcode);
            
            // GET 호출
            let url = /*[[@{/api/classunit/selectunitlist.json}]]*/"";
            url += `?classcode=${ccode}`;
            // console.log(url);
            const headers = {"Content-Type":"application/json"};
            const { data } = await axios.get(url, { headers:headers });
            // console.log('반환 결과', data);

            // 기존 내용 초기화
            const unitList = document.querySelector(".unit-list");
            unitList.innerHTML = ""; 

            /********************************** 조회 *******************************/

            // 데이터 출력
            data.list.forEach(item => { 
                const div = document.createElement("div");
                div.classList.add("unit");

                div.style.border = "1px solid rgb(201, 197, 197)";
                div.style.backgroundColor = "white";
                div.style.borderRadius = "5px";
                div.style.height = "125px";
                div.style.padding = "10px";
                div.style.marginTop = "10px";
                
                // console.log(item);

                const [year, month, day] = item.classdate.split('-');
                
                // classstart와 classend 시간 변환
                const startTime = new Date(`2000-01-01T${item.classstart}`);
                const endTime = new Date(`2000-01-01T${item.classend}`);
                const startHour = startTime.getHours();
                const startMinute = startTime.getMinutes();
                const endHour = endTime.getHours();
                const endMinute = endTime.getMinutes();
                
                // 시간 형식 변환 함수
                const formatTime = (hour, minute) => {
                    let period = "오전";
                    let formattedHour = hour;
                    
                    if (hour >= 12) {
                        period = "오후";
                        formattedHour = hour === 12 ? 12 : hour - 12;
                    }
                    
                    return `${period} ${formattedHour}:${String(minute).padStart(2, '0')}`;
                };

                // classlevel 변환 함수
                const getClassLevel = (level) => {
                    switch (level) {
                        case 1:
                            return "입문자";
                        case 2:
                            return "경험자";
                        case 3:
                            return "숙련자";
                        default:
                            return "";
                    }
                };

                div.innerHTML = `<div id="unit-${item.no}">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="width:100%;">
                                            <span style="font-weight: bold; font-size: medium; color: green;">${year}년 ${month}월 ${day}일 (${item.classday.charAt(0)})</span><br />
                                            <span style="font-size: small; color:gray; font-weight: bold;">${formatTime(startHour, startMinute)} ~ ${formatTime(endHour, endMinute)}</span><br>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span style="font-size: small; color: gray; font-weight: bold;">난이도: ${getClassLevel(item.classlevel)}</span>
                                                <span style="font-size: small; color: gray; font-weight: bold; margin-left: auto;">신청인원: ${item.cnt} / ${item.maximum}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                        <button style="width: 49%; border: 1px solid gray" class="btn btn-sm btn-update" onclick="updateUnit(${classcode}, ${item.no})">수정</button>
                                        <button style="width: 49%; border: 1px solid gray" class="btn btn-sm btn-delete" onclick="deleteUnit(${classcode}, ${item.no})">삭제</button>
                                    </div>
                                </div>`;

                unitList.appendChild(div);
            });

            /***********************************************************************/

            unitList.style.overflow = "auto";
            //unitList.style.maxHeight = "700px";

            // 스크롤 영역의 최대 높이 동적 설정
            function setScrollMaxHeight() {
                const windowHeight = window.innerHeight;
                const topOffset = unitList.getBoundingClientRect().top;
                const marginBottom = 30; // 하단과의 간격을 조정하기 위한 값
                const scrollMaxHeight = windowHeight - topOffset - marginBottom;
                unitList.style.maxHeight = `${scrollMaxHeight}px`;
            }
            
            // 초기 로드 시 스크롤 영역 높이 설정
            setScrollMaxHeight();
            
            // 창 크기 변경 시 스크롤 영역 높이 재설정
            window.addEventListener('resize', setScrollMaxHeight);
        }   

        // 전체 일정 삭제
        document.getElementById("all_delete").onclick = async function() {       
            // 삭제 확인 창 표시
            const confirmMessage = "정말로 전체 일정을 삭제하시겠습니까?";
            if (confirm(confirmMessage)) {
                let url = /*[[@{/api/classunit/deleteall.json}]]*/"";
                url += `?classcode=${ccode}`;
                const body = {classproduct:{classcode:ccode}};
                const headers = {"Content-Type":"application/json"};
                const { data } = await axios.put(url, body, { headers:headers });
                console.log(body);

                if(data.status === 200){
                    alert("전체 일정 삭제가 완료되었습니다.");
                    const unitList = document.querySelector(".unit-list");
                    unitList.style.display = "none";

                    await selectAll(); // 일정 재조회
                    unitList.style.display = "block"; // 일정 리스트 
                }
                else {
                    alert("전체 일정 삭제에 실패하였습니다.");
                }
            }
        }
        
        
       
        
    </script>


</div>



